{% extends 'common/base.html' %}
{% load staticfiles %}


{% block headend %}
{% if device_id %}
<link rel="stylesheet" href="{% static 'common/style/ot_map.css' %}">
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.css" />
{% endif %}
{% endblock %}


{% block content %}
<div class="container">
    <h2>Search Reports</h2>
    <form method="post" role="form">
        {{form}}
        {% csrf_token %}
        <button type="submit" class="btn btn-success btn-sm">
            <span class="glyphicon glyphicon-search"></span>
        </button>
    </form>
    {% if device_id %}
    <br/>
    <div class="well">
	<p>Map for device id <b>{{device_id}}</b> between <span id="start_time"></span> to <span id="end_time"></span> in <span id="device_date"></span></p>
	<p># of reports with loc: {{reports|length}}</p>
	<p># of reports without loc: {{no_loc_reports_count}}</p>
	<p># of station points: {{stop_points_count}}</p>
	</div>
	<div id="map"></div>
	<script src="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.js"></script>
	<script src="{% static 'common/js/ot_map_utils.js' %}"></script>
	<script>
		$("#start_time").html(toHourMinSec(new Date("{{start_time.isoformat}}")));
		$("#end_time").html(toHourMinSec(new Date("{{end_time.isoformat}}")));
		$("#device_date").html(toDate(new Date("{{start_time.isoformat}}")));
		{% include 'analysis/analysis_map.js' %}
		$(function() {
			initMap();
		});
		
	</script>
    {% endif %}
</div>

{% endblock %}
